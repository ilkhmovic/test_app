{% extends "base.html" %}
{% block title %} Test Natijasi {% endblock title %}
{% block content %}
<style>
    .rating {
        display: flex;
        flex-direction: row-reverse;
        justify-content: flex-end;
    }

    .rating input {
        display: none;
    }

    .rating label {
        cursor: pointer;
        font-size: 30px;
        color: #ccc;
        transition: color 0.2s;
    }

    .rating label:hover,
    .rating label:hover~label,
    .rating input:checked~label {
        color: #ffc107;
    }
</style>
<div class="content mt-3">
    <div class="card">
        <div class="card-header bg-primary text-white">
            <h3 class="mb-0">Test Natijasi: {{ checktest.test.title }}</h3>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <h5>Natija ma'lumotlari:</h5>
                    <ul class="list-group">
                        <li class="list-group-item">
                            <strong>To'g'ri javoblar:</strong>
                            <span class="badge bg-success">{{ checktest.finded_questions }}</span>
                        </li>
                        <li class="list-group-item">
                            <strong>Umumiy savollar:</strong>
                            <span class="badge bg-info">{{ check_questions.count }}</span>
                        </li>
                        <li class="list-group-item">
                            <strong>Foiz:</strong>
                            <span class="badge bg-warning text-dark">{{ checktest.percentage }}%</span>
                        </li>
                        <li class="list-group-item">
                            <strong>Test o'tish foizi:</strong>
                            <span class="badge bg-secondary">{{ checktest.test.pass_percentage }}%</span>
                        </li>
                    </ul>
                </div>
                <div class="col-md-6">
                    <h5>Holat:</h5>
                    <div class="alert {% if checktest.user_passed %}alert-success{% else %}alert-danger{% endif %}">
                        {% if checktest.user_passed %}
                        <h4 class="alert-heading">Tabriklaymiz! ✅</h4>
                        <p class="mb-0">Siz testdan muvaffaqiyatli o'tdingiz!</p>
                        {% else %}
                        <h4 class="alert-heading">Afsuski ❌</h4>
                        <p class="mb-0">Siz testdan o'ta olmadingiz. Qayta urinib ko'ring!</p>
                        {% endif %}
                    </div>

                </div>

                {% if checktest.user_passed %}
                <div class="mt-3">
                    <a href="{% url 'generate_certificate' checktest.id %}" class="btn btn-success w-100">
                        <i class="fas fa-certificate"></i> Sertifikat Yuklash
                    </a>
                </div>
                {% endif %}

                <div class="mt-2">
                    <a href="https://t.me/share/url?url=http://127.0.0.1:8000/&text=Men {{ checktest.test.title }} testidan {{ checktest.percentage }}% natija oldim! Senga ham tavsiya qilaman."
                        target="_blank" class="btn btn-info text-white w-100">
                        <i class="fab fa-telegram-plane"></i> Natijani Ulashish
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="card mt-4">
    <div class="card-header bg-secondary text-white">
        <h5 class="mb-0">Test haqida fikringiz</h5>
    </div>
    <div class="card-body">
        <form action="{% url 'add_review' checktest.test.id %}" method="post">
            {% csrf_token %}
            <div class="mb-3">
                <label class="form-label">Bahoyingiz:</label>
                <div class="rating">
                    <input type="radio" name="rating" value="5" id="r5"><label for="r5">★</label>
                    <input type="radio" name="rating" value="4" id="r4"><label for="r4">★</label>
                    <input type="radio" name="rating" value="3" id="r3"><label for="r3">★</label>
                    <input type="radio" name="rating" value="2" id="r2"><label for="r2">★</label>
                    <input type="radio" name="rating" value="1" id="r1"><label for="r1">★</label>
                </div>
            </div>
            <div class="mb-3">
                <textarea name="comment" class="form-control" rows="3" placeholder="Fikringizni yozing..."
                    required></textarea>
            </div>
            <button type="submit" class="btn btn-primary">Yuborish</button>
        </form>
    </div>
</div>

<hr>


<h5>Savol va javoblar:</h5>
<div class="mt-3">
    {% for check_question in check_questions %}
    <div class="card mb-2 {% if check_question.is_true %}border-success{% else %}border-danger{% endif %}">
        <div class="card-body">
            <h6>{{ forloop.counter }}. {{ check_question.question.question }}</h6>
            <p><strong>Sizning javobingiz:</strong>
                <span class="{% if check_question.is_true %}text-success{% else %}text-danger{% endif %}">
                    {{ check_question.given_answer|upper }} - {{ check_question.question.a }}
                </span>
            </p>
            {% if not check_question.is_true %}
            <p><strong>To'g'ri javob:</strong>
                <span class="text-success">{{ check_question.true_answer|upper }} -
                    {% if check_question.true_answer == 'a' %}{{ check_question.question.a }}
                    {% elif check_question.true_answer == 'b' %}{{ check_question.question.b }}
                    {% elif check_question.true_answer == 'c' %}{{ check_question.question.c }}
                    {% elif check_question.true_answer == 'd' %}{{ check_question.question.d }}
                    {% endif %}
                </span>
            </p>
            {% endif %}
            <span class="badge {% if check_question.is_true %}bg-success{% else %}bg-danger{% endif %}">
                {% if check_question.is_true %}To'g'ri{% else %}Noto'g'ri{% endif %}
            </span>
        </div>
    </div>
    {% endfor %}
</div>

<div class="mt-4">
    <a href="{% url 'index' %}" class="btn btn-primary">Bosh sahifaga qaytish</a>
    <a href="{% url 'ready_to_test' checktest.test.id %}" class="btn btn-outline-secondary">Qayta urinish</a>
</div>
</div>
</div>
</div>
{% endblock content %}